{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('modules/itrblueboost/views/css/admin-common.css') }}">
{% endblock %}

{% block content %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-header-title">
                <i class="material-icons">help_outline</i>
                {{ 'Generated FAQs'|trans({}, 'Modules.Itrblueboost.Admin') }}
                <span class="badge badge-primary ml-2">{{ totalFaqs }}</span>
            </h3>
        </div>
        <div class="card-body">
            {% include '@Modules/itrblueboost/views/templates/admin/_partials/_filter_status.html.twig' with {
                showTypeFilter: true,
                typeFilter: typeFilter,
                statusFilter: statusFilter,
                currentLimit: currentLimit,
            } only %}

            {% if faqs|length > 0 %}
                <div class="table-responsive">
                    <table class="faq-table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">{{ 'Type'|trans({}, 'Admin.Global') }}</th>
                                <th style="width: 200px;">{{ 'Entity'|trans({}, 'Admin.Global') }}</th>
                                <th>{{ 'Question / Answer'|trans({}, 'Modules.Itrblueboost.Admin') }}</th>
                                <th style="width: 100px;">{{ 'Status'|trans({}, 'Admin.Global') }}</th>
                                <th style="width: 140px;">{{ 'Date'|trans({}, 'Admin.Global') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for faq in faqs %}
                                <tr>
                                    <td>
                                        <span class="type-badge type-{{ faq.faq_type }}">
                                            {{ faq.faq_type == 'product' ? 'Produit' : 'Cat√©gorie' }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if faq.faq_type == 'product' %}
                                            <a href="{{ path('admin_product_form', {id: faq.id_product}) }}" class="entity-link" target="_blank">
                                                {{ faq.entity_name|default('Product #' ~ faq.id_product) }}
                                            </a>
                                        {% else %}
                                            <a href="{{ path('admin_categories_edit', {categoryId: faq.id_category}) }}" class="entity-link" target="_blank">
                                                {{ faq.entity_name|default('Category #' ~ faq.id_category) }}
                                            </a>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="faq-question">{{ faq.question|default('-') }}</div>
                                        <div class="faq-answer">{{ faq.answer|default('-')|striptags }}</div>
                                    </td>
                                    <td>
                                        {% if faq.faq_type == 'product' %}
                                            <span class="status-badge status-{{ faq.active ? 'active' : 'inactive' }}">
                                                {{ faq.active ? 'Actif' : 'Inactif' }}
                                            </span>
                                        {% else %}
                                            <span class="status-badge status-{{ faq.status }}">
                                                {{ faq.status }}
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>{{ faq.date_add|date('d/m/Y H:i') }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% include '@Modules/itrblueboost/views/templates/admin/_partials/_pagination.html.twig' with {
                    routeName: 'itrblueboost_admin_generated_faqs',
                    routeParams: {type: typeFilter, status: statusFilter},
                    currentPage: currentPage,
                    totalPages: totalPages,
                    currentLimit: currentLimit,
                } only %}
            {% else %}
                <div class="empty-state">
                    <i class="material-icons">quiz</i>
                    <h4>{{ 'No FAQs generated yet'|trans({}, 'Modules.Itrblueboost.Admin') }}</h4>
                    <p class="text-muted">{{ 'Generated FAQs will appear here.'|trans({}, 'Modules.Itrblueboost.Admin') }}</p>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        (function() {
            'use strict';

            var typeFilterEl = document.getElementById('typeFilter');
            if (typeFilterEl) {
                typeFilterEl.addEventListener('change', function() {
                    var url = new URL(window.location.href);
                    if (this.value) {
                        url.searchParams.set('type', this.value);
                    } else {
                        url.searchParams.delete('type');
                    }
                    url.searchParams.delete('page');
                    window.location.href = url.toString();
                });
            }

            document.getElementById('limitFilter').addEventListener('change', function() {
                var url = new URL(window.location.href);
                url.searchParams.set('limit', this.value);
                url.searchParams.delete('page');
                window.location.href = url.toString();
            });
        })();
    </script>
{% endblock %}
